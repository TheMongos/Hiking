<!DOCTYPE html>
<html>
<head>
<title>jQuery Mobile Application</title>
<link rel="stylesheet" href="/public/css/jquery.mobile-1.3.0.css" />
<script src="/public/js/jquery1.8.3.js"></script>
<script src="/public/js/jquery.mobile-1.3.0.min.js">
</script>
</head>
<body><!-- begin first page -->

<section id="pageStudentList" data-role="page">
	<header data-role="header" data-position="fixed">
	<h1>Students</h1>
	<a href="#pageSettings" data-transition="flip" 	data-role="button" 	data-icon="gear" data-iconpos="notext" class="ui-btn-right">Options</a>
	</header>
	<div class="content" data-role="content" id="maincontent">
	</div>
	<footer data-role="footer" data-position="fixed"><h1><i>Student Mobile</i></h1></footer>
</section>
<!-- End: Main student list view -->
<script type = "text/javascript">

var studentsList = null;
function getStudents()
{
var request = false;
request = new XMLHttpRequest();

	if (request)
	{
		var obj = document.getElementById('listDiv');
		request.open("GET","/users");
		
		request.onreadystatechange = function()
		{	
			if (request.readyState == 4 &&
					request.status == 200){
					studentsList = JSON.parse(request.responseText);
					if(studentsList != null)
					{
						var listString = "<ul data-role='listview' id='listDiv'>";
						for (var i=0;i<studentsList.length;i++)
							listString +="<li><a href='users/"+studentsList[i].username+"'>"+studentsList[i].username	+"</li>";
					}
					console.log("listString="+listString);
					
				$('#maincontent').append(listString);
				$('#maincontent').trigger("create");//refreashing dynamically
				$('#maincontent a').on('click',function(e){
					console.log(e);
					e.preventDefault();
					load(e.target.href);
					});
			}
		}
		
		request.send(null);
	} 
}

</script>
<script>
function load(pageUrl)
{
		console.log("pageUrl="+pageUrl);
		$('#maincontent').load(pageUrl);
}

//$(document).on('mobileinit', function() { //for mobile
$(document).on('ready', function() {
    
	getStudents();
	
});
</script>
</body>
</html>